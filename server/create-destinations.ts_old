#!/usr/bin/env tsx
import { db } from './db.js';
import { destinations } from '../shared/schema.js';

/**
 * Script para criar destinos no banco MySQL
 * Compat√≠vel com o esquema atual
 */
async function createDestinations() {
  console.log('üåç Criando destinos no banco MySQL...');

  try {
    const destinationsData = [
      // DESTINOS NACIONAIS - Sudeste
      {
        name: 'Rio de Janeiro',
        state: 'RJ',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sudeste',
        continent: 'Am√©rica do Sul',
        latitude: -22.9068,
        longitude: -43.1729,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Cidade Maravilhosa com Cristo Redentor, P√£o de A√ß√∫car e praias famosas'
      },
      {
        name: 'S√£o Paulo',
        state: 'SP',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sudeste',
        continent: 'Am√©rica do Sul',
        latitude: -23.5505,
        longitude: -46.6333,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Maior metr√≥pole do pa√≠s com rica vida cultural e gastron√¥mica'
      },
      {
        name: 'Belo Horizonte',
        state: 'MG',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sudeste',
        continent: 'Am√©rica do Sul',
        latitude: -19.9191,
        longitude: -43.9386,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Capital mineira com gastronomia tradicional e arquitetura moderna'
      },
      {
        name: 'Vit√≥ria',
        state: 'ES',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sudeste',
        continent: 'Am√©rica do Sul',
        latitude: -20.3155,
        longitude: -40.3128,
        timezone: 'America/Sao_Paulo',
        isPopular: false,
        description: 'Capital capixaba com belas praias e cultura local'
      },

      // DESTINOS NACIONAIS - Sul
      {
        name: 'Porto Alegre',
        state: 'RS',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sul',
        continent: 'Am√©rica do Sul',
        latitude: -30.0346,
        longitude: -51.2177,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Capital ga√∫cha com tradi√ß√£o cultural e gastron√¥mica'
      },
      {
        name: 'Gramado',
        state: 'RS',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sul',
        continent: 'Am√©rica do Sul',
        latitude: -29.3788,
        longitude: -50.8738,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Charme europeu na Serra Ga√∫cha com arquitetura alem√£'
      },
      {
        name: 'Florian√≥polis',
        state: 'SC',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sul',
        continent: 'Am√©rica do Sul',
        latitude: -27.5954,
        longitude: -48.5480,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Ilha da Magia com praias paradis√≠acas e vida noturna'
      },
      {
        name: 'Curitiba',
        state: 'PR',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sul',
        continent: 'Am√©rica do Sul',
        latitude: -25.4284,
        longitude: -49.2733,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Capital ecol√≥gica com planejamento urbano exemplar'
      },
      {
        name: 'Foz do Igua√ßu',
        state: 'PR',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Sul',
        continent: 'Am√©rica do Sul',
        latitude: -25.5478,
        longitude: -54.5882,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Lar das famosas Cataratas do Igua√ßu'
      },

      // DESTINOS NACIONAIS - Nordeste
      {
        name: 'Salvador',
        state: 'BA',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Nordeste',
        continent: 'Am√©rica do Sul',
        latitude: -12.9714,
        longitude: -38.5014,
        timezone: 'America/Bahia',
        isPopular: true,
        description: 'Primeira capital do Brasil com centro hist√≥rico preservado'
      },
      {
        name: 'Recife',
        state: 'PE',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Nordeste',
        continent: 'Am√©rica do Sul',
        latitude: -8.0476,
        longitude: -34.8770,
        timezone: 'America/Recife',
        isPopular: true,
        description: 'Veneza brasileira com rica cultura e frevo'
      },
      {
        name: 'Fortaleza',
        state: 'CE',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Nordeste',
        continent: 'Am√©rica do Sul',
        latitude: -3.7319,
        longitude: -38.5267,
        timezone: 'America/Fortaleza',
        isPopular: true,
        description: 'Praias paradis√≠acas e vida noturna agitada'
      },

      // DESTINOS NACIONAIS - Centro-Oeste
      {
        name: 'Bras√≠lia',
        state: 'DF',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Centro-Oeste',
        continent: 'Am√©rica do Sul',
        latitude: -15.8267,
        longitude: -47.9218,
        timezone: 'America/Sao_Paulo',
        isPopular: true,
        description: 'Capital federal com arquitetura modernista de Niemeyer'
      },
      {
        name: 'Campo Grande',
        state: 'MS',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Centro-Oeste',
        continent: 'Am√©rica do Sul',
        latitude: -20.4697,
        longitude: -54.6201,
        timezone: 'America/Campo_Grande',
        isPopular: false,
        description: 'Portal de entrada para o Pantanal'
      },
      {
        name: 'Bonito',
        state: 'MS',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Centro-Oeste',
        continent: 'Am√©rica do Sul',
        latitude: -21.1269,
        longitude: -56.4295,
        timezone: 'America/Campo_Grande',
        isPopular: true,
        description: 'Ecoturismo com √°guas cristalinas e cavernas'
      },

      // DESTINOS NACIONAIS - Norte
      {
        name: 'Manaus',
        state: 'AM',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Norte',
        continent: 'Am√©rica do Sul',
        latitude: -3.1190,
        longitude: -60.0217,
        timezone: 'America/Manaus',
        isPopular: true,
        description: 'Portal de entrada para a Amaz√¥nia'
      },
      {
        name: 'Bel√©m',
        state: 'PA',
        country: 'Brasil',
        countryType: 'nacional' as const,
        region: 'Norte',
        continent: 'Am√©rica do Sul',
        latitude: -1.4558,
        longitude: -48.5044,
        timezone: 'America/Belem',
        isPopular: true,
        description: 'Portal de entrada para a Amaz√¥nia Oriental'
      },

      // DESTINOS INTERNACIONAIS - Am√©rica do Norte
      {
        name: 'Nova York',
        state: 'NY',
        country: 'Estados Unidos',
        countryType: 'internacional' as const,
        region: 'Costa Leste',
        continent: 'Am√©rica do Norte',
        latitude: 40.7128,
        longitude: -74.0060,
        timezone: 'America/New_York',
        isPopular: true,
        description: 'A cidade que nunca dorme com √≠cones mundiais'
      },
      {
        name: 'Los Angeles',
        state: 'CA',
        country: 'Estados Unidos',
        countryType: 'internacional' as const,
        region: 'Costa Oeste',
        continent: 'Am√©rica do Norte',
        latitude: 34.0522,
        longitude: -118.2437,
        timezone: 'America/Los_Angeles',
        isPopular: true,
        description: 'Cidade dos anjos e capital do cinema mundial'
      },

      // DESTINOS INTERNACIONAIS - Europa
      {
        name: 'Paris',
        state: '√éle-de-France',
        country: 'Fran√ßa',
        countryType: 'internacional' as const,
        region: 'Europa Ocidental',
        continent: 'Europa',
        latitude: 48.8566,
        longitude: 2.3522,
        timezone: 'Europe/Paris',
        isPopular: true,
        description: 'Cidade Luz com arte, cultura e romanticismo'
      },
      {
        name: 'Londres',
        state: 'Inglaterra',
        country: 'Reino Unido',
        countryType: 'internacional' as const,
        region: 'Europa Ocidental',
        continent: 'Europa',
        latitude: 51.5074,
        longitude: -0.1278,
        timezone: 'Europe/London',
        isPopular: true,
        description: 'Capital brit√¢nica com hist√≥ria e tradi√ß√£o'
      },
      {
        name: 'Roma',
        state: 'Lazio',
        country: 'It√°lia',
        countryType: 'internacional' as const,
        region: 'Europa Meridional',
        continent: 'Europa',
        latitude: 41.9028,
        longitude: 12.4964,
        timezone: 'Europe/Rome',
        isPopular: true,
        description: 'Cidade Eterna com hist√≥ria milenar'
      },

      // DESTINOS INTERNACIONAIS - Am√©rica do Sul
      {
        name: 'Buenos Aires',
        state: 'Buenos Aires',
        country: 'Argentina',
        countryType: 'internacional' as const,
        region: 'Am√©rica do Sul',
        continent: 'Am√©rica do Sul',
        latitude: -34.6118,
        longitude: -58.3960,
        timezone: 'America/Argentina/Buenos_Aires',
        isPopular: true,
        description: 'Paris da Am√©rica do Sul com tango e cultura portenha'
      },
      {
        name: 'Santiago',
        state: 'Metropolitana',
        country: 'Chile',
        countryType: 'internacional' as const,
        region: 'Am√©rica do Sul',
        continent: 'Am√©rica do Sul',
        latitude: -33.4489,
        longitude: -70.6693,
        timezone: 'America/Santiago',
        isPopular: true,
        description: 'Capital chilena entre os Andes e o Pac√≠fico'
      }
    ];

    console.log(`üì• Inserindo ${destinationsData.length} destinos...`);
    
    let insertedCount = 0;
    for (const destination of destinationsData) {
      try {
        await db.insert(destinations).values(destination);
        console.log(`‚úÖ ${destination.name}, ${destination.state} (${destination.country})`);
        insertedCount++;
      } catch (error: any) {
        if (error.code === 'ER_DUP_ENTRY') {
          console.log(`‚ö†Ô∏è  ${destination.name} j√° existe - ignorando`);
        } else {
          console.error(`‚ùå Erro ao inserir ${destination.name}:`, error.message);
        }
      }
    }

    // Verificar resultados
    const totalDestinations = await db.select().from(destinations);
    console.log(`\nüìä RESUMO:`);
    console.log(`   üåç Destinos inseridos: ${insertedCount}`);
    console.log(`   üìä Total no banco: ${totalDestinations.length}`);
    console.log(`\nüéâ Cria√ß√£o de destinos conclu√≠da!`);

    return insertedCount;

  } catch (error) {
    console.error('‚ùå Erro ao criar destinos:', error);
    throw error;
  }
}

// Executar se chamado diretamente
if (import.meta.url === `file://${process.argv[1]}`) {
  createDestinations()
    .then((count) => {
      console.log(`‚úÖ Processo conclu√≠do! ${count} destinos criados.`);
      process.exit(0);
    })
    .catch((error) => {
      console.error('‚ùå Erro no processo:', error);
      process.exit(1);
    });
}

export { createDestinations };